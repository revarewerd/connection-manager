# üîç –§–ü-–ê—É–¥–∏—Ç Connection Manager

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —á–∏—Å—Ç–æ—Ç—ã

---

## 1. ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–´ –§–ü-–ß–ò–°–¢–û–¢–´

### 1.1. `ConnectionHandler.scala` - –ì—Ä—è–∑–Ω—ã–π –∫–æ–¥ (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–∑–¥–∞–Ω–∏–µ `Ref` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∫–ª–∞—Å—Å–∞ —á–µ—Ä–µ–∑ `Unsafe.unsafe`

```scala
// ‚ùå –ü–õ–û–•–û: –ò–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ Ref –≤–Ω–µ ZIO –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
private val stateRef: Ref[ConnectionState] = 
  Unsafe.unsafe(implicit u => runtime.unsafe.run(Ref.make(ConnectionState())).getOrThrow())
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø–ª–æ—Ö–æ:**
- –ù–∞—Ä—É—à–∞–µ—Ç referential transparency
- –≠—Ñ—Ñ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞, –∞ –Ω–µ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ runtime

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```scala
// ‚úÖ –•–û–†–û–®–û: –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å Ref –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä, —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤ ZIO
class ConnectionHandler(
    service: GpsProcessingService,
    parser: ProtocolParser,
    registry: ConnectionRegistry,
    runtime: Runtime[Any],
    stateRef: Ref[ConnectionState]  // –ü–µ—Ä–µ–¥–∞—ë–º –≥–æ—Ç–æ–≤—ã–π Ref
) extends ChannelInboundHandlerAdapter
```

---

### 1.2. `RedisClient.scala` - Callback –≤ Pub/Sub

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–ø—É—Å–∫ ZIO —ç—Ñ—Ñ–µ–∫—Ç–∞ –≤ Java callback —á–µ—Ä–µ–∑ `Unsafe.unsafe`

```scala
// ‚ö†Ô∏è –î–û–ü–£–°–¢–ò–ú–û, –Ω–æ –≥—Ä—è–∑–Ω–æ: –ú–æ—Å—Ç –º–µ–∂–¥—É Java –∏ ZIO
val listener = new RedisPubSubAdapter[String, String] {
  override def message(ch: String, message: String): Unit =
    Unsafe.unsafe { implicit unsafe =>
      runtime.unsafe.run(handler(message).catchAll(e => ZIO.logError(s"Handler error: $e"))).getOrThrowFiberFailure()
    }
}
```

**–°—Ç–∞—Ç—É—Å:** –≠—Ç–æ –≥—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É Java –∏ ZIO. –ü—Ä–∏–µ–º–ª–µ–º–æ, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å —á–µ—Ä–µ–∑ `ZIO.fromFuture` –∏–ª–∏ `ZStream`.

---

### 1.3. `TcpServer.scala` - `RateLimitHandler` —Å Unsafe

**–ü—Ä–æ–±–ª–µ–º–∞:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ - Netty callback —Ç—Ä–µ–±—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```scala
// ‚ö†Ô∏è –î–û–ü–£–°–¢–ò–ú–û: Netty —Ç—Ä–µ–±—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥
Unsafe.unsafe { implicit u =>
  runtime.unsafe.run(effect).getOrThrowFiberFailure()
}
```

---

### 1.4. `TeltonikaParser.scala` - –ú—É—Ç–∞—Ü–∏–∏ –±—É—Ñ–µ—Ä–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** `ByteBuf` –∏–∑ Netty - –º—É—Ç–∞–±–µ–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç

```scala
// ‚ö†Ô∏è –ù–ï–ò–ó–ë–ï–ñ–ù–û: Netty ByteBuf –≤—Å–µ–≥–¥–∞ –º—É—Ç–∞–±–µ–ª—å–Ω—ã–π
val length = buffer.readUnsignedShort()  // –ú—É—Ç–∏—Ä—É–µ—Ç readerIndex
buffer.readBytes(imeiBytes)               // –ú—É—Ç–∏—Ä—É–µ—Ç readerIndex
```

**–°—Ç–∞—Ç—É—Å:** –≠—Ç–æ –≥—Ä–∞–Ω–∏—Ü–∞ —Å Java/Netty. –ú—É—Ç–∞—Ü–∏—è –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–∞, –Ω–µ —É—Ç–µ–∫–∞–µ—Ç –Ω–∞—Ä—É–∂—É.

---

### 1.5. `skipIoElements` - –ò–º–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ü–∏–∫–ª—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `foreach` —Å –ø–æ–±–æ—á–Ω—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏

```scala
// ‚ùå –ü–õ–û–•–û: –ò–º–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å
(0 until count1).foreach { _ =>
  buffer.readUnsignedShort() // id
  buffer.readByte() // value
}
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```scala
// ‚úÖ –õ–£–ß–®–ï: –Ø–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
(0 until count1).foreach { _ =>
  val _ = buffer.readUnsignedShort() // id - –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ–º
  val _ = buffer.readByte()          // value - –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ–º
}
```

---

## 2. üìù –ü–†–û–ë–õ–ï–ú–´ –° –ö–û–ú–ú–ï–ù–¢–ê–†–ò–Ø–ú–ò

### 2.1. –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–ò–°–ü–†–ê–í–ò–¢–¨)

–ù–∞–π–¥–µ–Ω—ã –≤ —Ñ–∞–π–ª–∞—Ö:
- `CommandService.scala`: "Pending command with its promise"
- `Command.scala`: "–ë–∞–∑–æ–≤—ã–π trait" - —Å–º–µ—à–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤
- `TcpServer.scala`: –ß–∞—Å—Ç–∏—á–Ω–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º

### 2.2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

–§–∞–π–ª—ã –±–µ–∑ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
- `IdleConnectionWatcher.scala`
- `VehicleLookupService.scala`
- `DeviceRepository.scala`

---

## 3. üìä –ü–õ–ê–ù –ò–ó–£–ß–ï–ù–ò–Ø –°–ï–†–í–ò–°–ê

### –£—Ä–æ–≤–µ–Ω—å 1: –î–æ–º–µ–Ω (30 –º–∏–Ω—É—Ç)
```
1. domain/GpsPoint.scala        - –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
2. domain/Command.scala         - –¢–∏–ø—ã –∫–æ–º–∞–Ω–¥
3. config/AppConfig.scala       - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

### –£—Ä–æ–≤–µ–Ω—å 2: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (1 —á–∞—Å)
```
4. storage/RedisClient.scala    - –†–∞–±–æ—Ç–∞ —Å Redis
5. storage/KafkaProducer.scala  - –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
6. storage/DeviceRepository.scala - PostgreSQL (–∑–∞–≥–æ—Ç–æ–≤–∫–∞)
```

### –£—Ä–æ–≤–µ–Ω—å 3: –ü—Ä–æ—Ç–æ–∫–æ–ª—ã (1 —á–∞—Å)
```
7. protocol/ProtocolParser.scala    - –ë–∞–∑–æ–≤—ã–π trait
8. protocol/TeltonikaParser.scala   - –°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª
9. protocol/WialonParser.scala      - –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª
```

### –£—Ä–æ–≤–µ–Ω—å 4: –°–µ—Ç—å (1.5 —á–∞—Å–∞)
```
10. network/TcpServer.scala         - Netty —Å–µ—Ä–≤–µ—Ä
11. network/ConnectionHandler.scala - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–ö–õ–Æ–ß–ï–í–û–ô)
12. network/ConnectionRegistry.scala - –†–µ–µ—Å—Ç—Ä —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
13. network/RateLimiter.scala       - –ó–∞—â–∏—Ç–∞ –æ—Ç DDoS
```

### –£—Ä–æ–≤–µ–Ω—å 5: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (30 –º–∏–Ω—É—Ç)
```
14. filter/DeadReckoningFilter.scala  - –§–∏–ª—å—Ç—Ä –∞–Ω–æ–º–∞–ª–∏–π
15. filter/StationaryFilter.scala     - –§–∏–ª—å—Ç—Ä —Å—Ç–æ—è–Ω–æ–∫
```

### –£—Ä–æ–≤–µ–Ω—å 6: –°–µ—Ä–≤–∏—Å—ã (1 —á–∞—Å)
```
16. network/CommandService.scala        - –ö–æ–º–∞–Ω–¥—ã –Ω–∞ —Ç—Ä–µ–∫–µ—Ä—ã
17. network/IdleConnectionWatcher.scala - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ idle
18. network/DeviceConfigListener.scala  - –°–ª—É—à–∞—Ç–µ–ª—å –∫–æ–Ω—Ñ–∏–≥–∞
19. config/DynamicConfigService.scala   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

### –£—Ä–æ–≤–µ–Ω—å 7: API –∏ –∑–∞–ø—É—Å–∫ (30 –º–∏–Ω—É—Ç)
```
20. api/HttpApi.scala - REST API
21. Main.scala        - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Å–ª–æ—ë–≤
```

---

## 4. üê≥ DOCKER –ù–ê–°–¢–†–û–ô–ö–ê

### –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–≥–æ docker-compose.yml:
1. ‚ùå –ù–µ—Ç —Å–µ—Ä–≤–∏—Å–∞ connection-manager
2. ‚ùå –ù–µ—Ç Dockerfile –¥–ª—è —Å–±–æ—Ä–∫–∏
3. ‚ùå –ù–µ—Ç healthcheck –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

## 5. üß™ –ü–õ–ê–ù –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### 5.1. Unit —Ç–µ—Å—Ç—ã (–ß–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å |
|-----------|-----------------|
| `GeoMath.haversineDistance` | –†–∞—Å—á—ë—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –º–µ–∂–¥—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ |
| `DeadReckoningFilter` | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ—á–µ–∫ –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏/—Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏ |
| `StationaryFilter` | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è/—Å—Ç–æ—è–Ω–∫–∏ |
| `TeltonikaParser.parseImei` | –ü–∞—Ä—Å–∏–Ω–≥ IMEI –∏–∑ –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| `TeltonikaParser.parseData` | –ü–∞—Ä—Å–∏–Ω–≥ AVL –∑–∞–ø–∏—Å–µ–π |

### 5.2. Integration —Ç–µ—Å—Ç—ã (–° Redis/Kafka)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å |
|-----------|-----------------|
| `RedisClient` | CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏, Pub/Sub |
| `KafkaProducer` | –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π |
| `ConnectionRegistry` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/—É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π |
| `RateLimiter` | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø–æ IP |

### 5.3. E2E —Ç–µ—Å—Ç—ã (–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª)

| –°—Ü–µ–Ω–∞—Ä–∏–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| Happy Path | –¢—Ä–µ–∫–µ—Ä –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ ‚Üí –ø–æ–ª—É—á–∞–µ—Ç ACK |
| Unknown IMEI | –¢—Ä–µ–∫–µ—Ä —Å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–º IMEI –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è |
| Reconnect | –¢—Ä–µ–∫–µ—Ä –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è, —Å—Ç–∞—Ä–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è |
| Idle Timeout | –ù–µ–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è |
| Rate Limit | –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –æ–¥–Ω–æ–≥–æ IP |

### 5.4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
src/test/scala/com/wayrecall/tracker/
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îî‚îÄ‚îÄ GeoMathSpec.scala
‚îú‚îÄ‚îÄ filter/
‚îÇ   ‚îú‚îÄ‚îÄ DeadReckoningFilterSpec.scala
‚îÇ   ‚îî‚îÄ‚îÄ StationaryFilterSpec.scala
‚îú‚îÄ‚îÄ protocol/
‚îÇ   ‚îú‚îÄ‚îÄ TeltonikaParserSpec.scala
‚îÇ   ‚îî‚îÄ‚îÄ WialonParserSpec.scala
‚îú‚îÄ‚îÄ network/
‚îÇ   ‚îú‚îÄ‚îÄ ConnectionRegistrySpec.scala
‚îÇ   ‚îî‚îÄ‚îÄ RateLimiterSpec.scala
‚îî‚îÄ‚îÄ integration/
    ‚îú‚îÄ‚îÄ RedisClientSpec.scala
    ‚îî‚îÄ‚îÄ KafkaProducerSpec.scala
```

---

## 6. –ü–†–ò–û–†–ò–¢–ï–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### üî¥ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ)

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å |
|----------|--------|
| –°–æ–∑–¥–∞—Ç—å Dockerfile –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ docker-compose | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| –î–æ–±–∞–≤–∏—Ç—å init —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è Redis (—Ç–µ—Å—Ç–æ–≤—ã–µ IMEI) | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| `calculateCrc16` —Å `var` ‚Üí —á–∏—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è —á–µ—Ä–µ–∑ `foldLeft` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| `skipIoElements` –±–µ–∑ —è–≤–Ω–æ–≥–æ discard ‚Üí –¥–æ–±–∞–≤–ª–µ–Ω `val _ =` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |

### üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ)

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å |
|----------|--------|
| –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ `IdleConnectionWatcher` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ `VehicleLookupService` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ `DeviceRepository` | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |

### üü¢ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (TODO)

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å |
|----------|--------|
| –£–ª—É—á—à–∏—Ç—å ConnectionHandler (–ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å Ref –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä) | ‚ö†Ô∏è –î–æ–ø—É—Å—Ç–∏–º–æ, –≥—Ä–∞–Ω–∏—Ü–∞ —Å Netty |
| Integration —Ç–µ—Å—Ç—ã | üîú –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ |
| E2E —Ç–µ—Å—Ç—ã | üîú –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ |

---

## 7. –ò–¢–û–ì –†–ï–í–¨–Æ (–û–±–Ω–æ–≤–ª–µ–Ω–æ 26.01.2026)

### ‚úÖ –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –§–ü-–ø—Ä–∏–Ω—Ü–∏–ø–∞–º

- **–î–æ–º–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã** (`GpsPoint`, `Command`) - —á–∏—Å—Ç—ã–µ immutable case classes
- **–§–∏–ª—å—Ç—Ä—ã** (`DeadReckoningFilter`, `StationaryFilter`) - —á–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- **–°–µ—Ä–≤–∏—Å—ã** –∏—Å–ø–æ–ª—å–∑—É—é—Ç ZIO –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- **`calculateCrc16`** –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —á–µ—Ä–µ–∑ `foldLeft` –±–µ–∑ `var`
- **`skipIoElements`** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–≤–Ω—ã–π `val _ =` –¥–ª—è discard

### ‚ö†Ô∏è –î–æ–ø—É—Å—Ç–∏–º–∞—è "–≥—Ä—è–∑—å" –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞—Ö

- **ConnectionHandler** - `Unsafe.unsafe` –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –º–æ—Å—Ç–∞ Netty‚ÜîZIO
- **RedisClient Pub/Sub** - callback —Ç—Ä–µ–±—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **ByteBuf** - –º—É—Ç–∞–±–µ–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç Netty, –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –ø–∞—Ä—Å–µ—Ä–∞—Ö

### üìù –í—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ ‚úÖ

