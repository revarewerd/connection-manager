# üìö –ü—É—Ç–µ–≤–æ–¥–∏—Ç–µ–ª—å –ø–æ Connection Manager

## –ö–∞–∫ –∏–∑—É—á–∞—Ç—å —ç—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏–∑—É—á–µ–Ω–∏—è –∫–æ–¥–∞ –∏ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏.

---

## üéØ –£—Ä–æ–≤–µ–Ω—å 1: –î–æ–º–µ–Ω (30 –º–∏–Ω—É—Ç)

–ù–∞—á–Ω–∏—Ç–µ —Å –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö.

### 1.1. `domain/GpsPoint.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ GeoMath.haversineDistance() - —Ñ–æ—Ä–º—É–ª–∞ –•–∞–≤–µ—Ä—Å–∏–Ω–∞ –¥–ª—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π
‚îú‚îÄ‚îÄ GpsPoint - –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∏–ø GPS —Ç–æ—á–∫–∏
‚îú‚îÄ‚îÄ GpsRawPoint - —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç —Ç—Ä–µ–∫–µ—Ä–∞
‚îú‚îÄ‚îÄ ConnectionInfo - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
‚îú‚îÄ‚îÄ DisconnectReason - enum –ø—Ä–∏—á–∏–Ω –æ—Ç–∫–ª—é—á–µ–Ω–∏—è
‚îî‚îÄ‚îÄ DeviceStatus - —Å—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (online/offline)
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- `derives JsonCodec` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- `extension` - extension methods –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –∫ —Ç–∏–ø–∞–º
- –í—Å–µ —Ç–∏–ø—ã `case class` - immutable –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### 1.2. `domain/Command.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ Command (sealed trait) - –±–∞–∑–æ–≤—ã–π —Ç–∏–ø –∫–æ–º–∞–Ω–¥—ã
‚îú‚îÄ‚îÄ RebootCommand, SetIntervalCommand –∏ —Ç.–¥.
‚îú‚îÄ‚îÄ CommandStatus (enum) - —Å—Ç–∞—Ç—É—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
‚îî‚îÄ‚îÄ CommandResult - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- `sealed trait` - –∑–∞–∫—Ä—ã—Ç–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –¥–ª—è pattern matching
- ADT (Algebraic Data Types) - –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏

---

## üéØ –£—Ä–æ–≤–µ–Ω—å 2: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (20 –º–∏–Ω—É—Ç)

### 2.1. `config/AppConfig.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ AppConfig - –∫–æ—Ä–Ω–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ TcpConfig - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ TCP —Å–µ—Ä–≤–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ RedisConfig - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Redis
‚îú‚îÄ‚îÄ KafkaConfig - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Kafka
‚îú‚îÄ‚îÄ FilterConfig - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
‚îî‚îÄ‚îÄ RateLimitConfig - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ rate limiter
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- ZIO Config - –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `deriveConfig` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä—Å–µ—Ä–∞ –∏–∑ case class

### 2.2. `config/DynamicConfigService.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ DynamicConfigService (trait) - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ getFilterConfig - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ Ref (in-memory)
‚îú‚îÄ‚îÄ updateFilterConfig - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ subscribeToChanges - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Redis Pub/Sub
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- `Ref[A]` - –∞—Ç–æ–º–∞—Ä–Ω–∞—è –∏–∑–º–µ–Ω—è–µ–º–∞—è —Å—Å—ã–ª–∫–∞ –≤ ZIO
- Hot reload –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

---

## üéØ –£—Ä–æ–≤–µ–Ω—å 3: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (1 —á–∞—Å)

### 3.1. `storage/RedisClient.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ RedisClient (trait) - —á–∏—Å—Ç–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ getVehicleId(imei) - –º–∞–ø–ø–∏–Ω–≥ IMEI ‚Üí VehicleId
‚îú‚îÄ‚îÄ setPosition/getPosition - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π
‚îú‚îÄ‚îÄ subscribe/publish - Redis Pub/Sub
‚îî‚îÄ‚îÄ Live implementation —Å Lettuce
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- Service pattern - trait + Live implementation + ZLayer
- `ZIO.acquireRelease` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏ (–æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)
- `ZIO.fromFuture` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Java CompletableFuture

### 3.2. `storage/KafkaProducer.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ KafkaProducer (trait)
‚îú‚îÄ‚îÄ publishGpsEvent - –ø—É–±–ª–∏–∫–∞—Ü–∏—è GPS —Ç–æ—á–µ–∫
‚îú‚îÄ‚îÄ publishDeviceStatus - —Å—Ç–∞—Ç—É—Å—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤
‚îî‚îÄ‚îÄ publishUnknownDevice - –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ IMEI
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- `ZIO.async` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å callback-based API
- Error handling —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏ (KafkaError)

### 3.3. `storage/VehicleLookupService.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ VehicleLookupService (trait)
‚îú‚îÄ‚îÄ lookupVehicleId - Redis ‚Üí PostgreSQL ‚Üí Cache
‚îî‚îÄ‚îÄ Cache-Aside pattern
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- Fallback pattern - –µ—Å–ª–∏ Redis –ø—É—Å—Ç, –∏–¥—ë–º –≤ PostgreSQL
- Caching —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

---

## üéØ –£—Ä–æ–≤–µ–Ω—å 4: –ü—Ä–æ—Ç–æ–∫–æ–ª—ã (1 —á–∞—Å)

### 4.1. `protocol/ProtocolParser.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ ProtocolParser (trait) - –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–∞—Ä—Å–µ—Ä–∞
‚îú‚îÄ‚îÄ parseImei - –ø–∞—Ä—Å–∏–Ω–≥ –ø–µ—Ä–≤–æ–≥–æ –ø–∞–∫–µ—Ç–∞
‚îú‚îÄ‚îÄ parseData - –ø–∞—Ä—Å–∏–Ω–≥ GPS –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ imeiAck/ack - —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
‚îî‚îÄ‚îÄ encodeCommand - –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥
```

### 4.2. `protocol/TeltonikaParser.scala` (–ö–õ–Æ–ß–ï–í–û–ô)
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ Codec 8/8E —Ñ–æ—Ä–º–∞—Ç
‚îú‚îÄ‚îÄ AVL Record —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚îú‚îÄ‚îÄ CRC-16 –ø—Ä–æ–≤–µ—Ä–∫–∞
‚îî‚îÄ‚îÄ skipIoElements - –ø—Ä–æ–ø—É—Å–∫ IO —ç–ª–µ–º–µ–Ω—Ç–æ–≤
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- –ë–∏–Ω–∞—Ä–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —Å Netty ByteBuf
- –ü—Ä–æ—Ç–æ–∫–æ–ª Teltonika (—Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π)

### 4.3. `protocol/WialonParser.scala`
```
–û—Ç–ª–∏—á–∏–µ: —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –≤–º–µ—Å—Ç–æ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ
```

---

## üéØ –£—Ä–æ–≤–µ–Ω—å 5: –°–µ—Ç—å (1.5 —á–∞—Å–∞) - –°–ê–ú–û–ï –í–ê–ñ–ù–û–ï

### 5.1. `network/TcpServer.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ TcpServer (trait)
‚îú‚îÄ‚îÄ Netty bootstrap –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
‚îú‚îÄ‚îÄ ChannelInitializer - pipeline –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
‚îú‚îÄ‚îÄ RateLimitHandler - –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS
‚îî‚îÄ‚îÄ Graceful shutdown
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- Netty event loop model
- Channel pipeline

### 5.2. `network/ConnectionHandler.scala` (–ö–õ–Æ–ß–ï–í–û–ô –§–ê–ô–õ!)
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ ConnectionState - —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
‚îú‚îÄ‚îÄ GpsProcessingService (trait) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ ConnectionHandler (Netty handler)
‚îú‚îÄ‚îÄ handleImeiPacket - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ handleDataPacket - –æ–±—Ä–∞–±–æ—Ç–∫–∞ GPS
‚îú‚îÄ‚îÄ channelActive/channelInactive - –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- –ú–æ—Å—Ç –º–µ–∂–¥—É Netty (–∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π) –∏ ZIO (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π)
- Ref[ConnectionState] –¥–ª—è immutable —Å–æ—Å—Ç–æ—è–Ω–∏—è
- Error handling –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫

### 5.3. `network/ConnectionRegistry.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ ConnectionRegistry (trait)
‚îú‚îÄ‚îÄ register/unregister - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
‚îú‚îÄ‚îÄ findByImei - –ø–æ–∏—Å–∫ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ Reconnect handling - –∑–∞–∫—Ä—ã—Ç–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
‚îî‚îÄ‚îÄ getIdleConnections - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö
```

### 5.4. `network/RateLimiter.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ Sliding Window –∞–ª–≥–æ—Ä–∏—Ç–º
‚îú‚îÄ‚îÄ IP-based –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ Cleanup —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
```

---

## üéØ –£—Ä–æ–≤–µ–Ω—å 6: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (30 –º–∏–Ω—É—Ç)

### 6.1. `filter/DeadReckoningFilter.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
‚îú‚îÄ‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è timestamp
‚îî‚îÄ‚îÄ –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏
```

### 6.2. `filter/StationaryFilter.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è vs —Å—Ç–æ—è–Ω–∫–∏
‚îî‚îÄ‚îÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ Kafka
```

---

## üéØ –£—Ä–æ–≤–µ–Ω—å 7: –°–µ—Ä–≤–∏—Å—ã (1 —á–∞—Å)

### 7.1. `network/CommandService.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –Ω–∞ —Ç—Ä–µ–∫–µ—Ä—ã
‚îú‚îÄ‚îÄ –û–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ —Å Promise
‚îú‚îÄ‚îÄ Timeout handling
‚îî‚îÄ‚îÄ Redis Pub/Sub –¥–ª—è –∫–æ–º–∞–Ω–¥
```

### 7.2. `network/IdleConnectionWatcher.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ idle —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ ZIO Schedule
```

### 7.3. `network/DeviceConfigListener.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ Redis Pub/Sub pattern subscribe
‚îú‚îÄ‚îÄ –†–µ–∞–∫—Ü–∏—è –Ω–∞ disable/enable —É—Å—Ç—Ä–æ–π—Å—Ç–≤
‚îî‚îÄ‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
```

---

## üéØ –£—Ä–æ–≤–µ–Ω—å 8: API –∏ –∑–∞–ø—É—Å–∫ (30 –º–∏–Ω—É—Ç)

### 8.1. `api/HttpApi.scala`
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ ZIO HTTP routes
‚îú‚îÄ‚îÄ Health check endpoint
‚îú‚îÄ‚îÄ Config endpoints
‚îî‚îÄ‚îÄ Commands endpoint
```

### 8.2. `Main.scala` (–§–ò–ù–ê–õ–¨–ù–´–ô –§–ê–ô–õ)
```
–ß—Ç–æ –∏–∑—É—á–∏—Ç—å:
‚îú‚îÄ‚îÄ ZIOAppDefault - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ –ö–æ–º–ø–æ–∑–∏—Ü–∏—è –≤—Å–µ—Ö —Å–ª–æ—ë–≤ (ZLayer)
‚îú‚îÄ‚îÄ –ó–∞–ø—É—Å–∫ TCP —Å–µ—Ä–≤–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ Graceful shutdown
‚îî‚îÄ‚îÄ bootstrap –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä—ã–µ, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
```
src/test/scala/
‚îú‚îÄ‚îÄ domain/GeoMathSpec.scala
‚îú‚îÄ‚îÄ filter/DeadReckoningFilterSpec.scala
‚îî‚îÄ‚îÄ network/RateLimiterSpec.scala
```

### Integration —Ç–µ—Å—Ç—ã (—Ç—Ä–µ–±—É—é—Ç Redis/Kafka)
```
src/test/scala/integration/
‚îú‚îÄ‚îÄ RedisClientSpec.scala
‚îî‚îÄ‚îÄ KafkaProducerSpec.scala
```

---

## üê≥ –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
# 1. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
docker-compose -f docker-compose.dev.yml up -d redis kafka

# 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Redis —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
docker exec cm-redis sh /docker-entrypoint-initdb.d/init.sh

# 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ (dev —Ä–µ–∂–∏–º)
sbt run

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ health
curl http://localhost:8080/api/health

# 5. –¢–µ—Å—Ç —Å —Å–∏–º—É–ª—è—Ç–æ—Ä–æ–º
python3 docker/simulator.py --host localhost --port 5001 --imei 123456789012345
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# Kafka UI
open http://localhost:8090

# Redis Commander  
open http://localhost:8091

# –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞
docker logs -f cm-app
```
