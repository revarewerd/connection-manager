connection-manager {
  tcp {
    teltonika { port = 5001, enabled = true }
    wialon { port = 5002, enabled = true }
    ruptela { port = 5003, enabled = true }
    navtelecom { port = 5004, enabled = true }
    
    boss-threads = 1
    worker-threads = 4
    max-connections = 5000
    keep-alive = true
    tcp-nodelay = true
    connection-timeout-seconds = 30
    read-timeout-seconds = 60
    write-timeout-seconds = 30
    
    # Idle timeout - отключение неактивных соединений
    # Можно переопределить через Redis динамически
    idle-timeout-seconds = 300          # 5 минут без данных = disconnect
    idle-timeout-seconds = ${?TCP_IDLE_TIMEOUT}
    idle-check-interval-seconds = 60    # Проверка каждую минуту
  }
  
  http {
    port = 8080
    host = "0.0.0.0"
  }
  
  redis {
    host = "localhost"
    host = ${?REDIS_HOST}
    port = 6379
    port = ${?REDIS_PORT}
    password = null
    password = ${?REDIS_PASSWORD}
    database = 0
    pool-size = 10
    vehicle-ttl-seconds = 3600
    position-ttl-seconds = 3600
  }
  
  kafka {
    bootstrap-servers = "localhost:9092"
    bootstrap-servers = ${?KAFKA_BOOTSTRAP_SERVERS}
    producer {
      acks = "1"
      retries = 3
      batch-size = 16384
      linger-ms = 10
      compression-type = "snappy"
    }
    topics {
      raw-gps-events = "raw-gps-events"
      device-status = "device-status"
    }
  }
  
  filters {
    dead-reckoning {
      max-speed-kmh = 300
      max-jump-meters = 1000
      max-jump-seconds = 1
    }
    stationary {
      min-distance-meters = 20
      min-speed-kmh = 2
    }
  }
  
  commands {
    enabled = true
    timeout-seconds = 30
    max-retries = 3
    redis-channel-pattern = "commands:*"
    results-channel-prefix = "command-results:"
  }
  
  logging {
    level = "INFO"
    level = ${?LOG_LEVEL}
    log-gps-points = false
  }
}
